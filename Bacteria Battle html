<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bacteria Battle</title>
  <style>
    html,body{height:100%;margin:0;font-family:Arial;background:#071019;color:#dff}
    .wrap{display:flex;flex-direction:column;align-items:center;padding:16px}
    canvas{background:linear-gradient(#022,#013);border-radius:8px;display:block}
    .hud{margin-top:8px;display:flex;gap:12px;align-items:center}
    button{padding:6px 10px;border-radius:6px;border:none;background:#39f;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Bacteria Battle</h2>
    <canvas id="c" width="600" height="420"></canvas>
    <div class="hud">
      <div id="score">Score: 0</div>
      <div id="lives">Lives: 3</div>
      <button id="restart">Restart</button>
      <small>Use ← → to move, Space to shoot</small>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    let score=0, lives=3, running=false;
    const player = {x:W/2,y:H-30,w:36,h:18,spd:6};
    const bullets = [];
    const bacteria = [];
    let keys = {};

    function spawn(){
      const r = 12 + Math.random()*12;
      bacteria.push({x:Math.random()*(W-2*r)+r, y:-r, r, vx:(Math.random()-0.5)*1.5, vy:1+Math.random()*1.2});
    }

    function reset(){ score=0; lives=3; bacteria.length=0; bullets.length=0; running=true; }

    function rectColl(a,b){ return a.x < b.x + b.r && a.x + a.w > b.x && a.y < b.y + b.r && a.y + a.h > b.y; }

    function loop(){
      if(!running) return drawPause();
      update(); draw(); requestAnimationFrame(loop);
    }

    function update(){
      // player
      if(keys['ArrowLeft']) player.x-=player.spd; if(keys['ArrowRight']) player.x+=player.spd;
      player.x = Math.max(0, Math.min(W-player.w, player.x));

      // bullets
      for(let i=bullets.length-1;i>=0;i--){
        bullets[i].y -= 8;
        if(bullets[i].y < -10) bullets.splice(i,1);
      }
      // bacteria
      if(Math.random()<0.03 + Math.min(0.02, score*0.0008)) spawn();
      for(let i=bacteria.length-1;i>=0;i--){
        let b = bacteria[i]; b.x += b.vx; b.y += b.vy;
        if(b.x< -30 || b.x>W+30 || b.y>H+30){ bacteria.splice(i,1); continue; }

        // bullet collisions
        for(let j=bullets.length-1;j>=0;j--){
          const bl = bullets[j];
          const dx=b.x-bl.x, dy=b.y-bl.y; if(dx*dx+dy*dy < (b.r+4)*(b.r+4)){
            score += Math.round(10 + b.r*2);
            bacteria.splice(i,1); bullets.splice(j,1); break;
          }
        }

        // player hit
        const px = player.x + player.w/2, py = player.y + player.h/2;
        const dx = b.x - px, dy = b.y - py; if(dx*dx+dy*dy < (b.r+12)*(b.r+12)){
          lives--; bacteria.splice(i,1);
          if(lives<=0){ running=false; }
        }
      }
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      // background subtle grid
      for(let i=0;i<10;i++){ ctx.globalAlpha=0.03; ctx.fillStyle='#9fd'; ctx.fillRect(i*60,0,1,H); ctx.fillRect(0,i*42,W,1);} ctx.globalAlpha=1;

      // player (white cell)
      ctx.fillStyle='#fff'; roundRect(ctx, player.x, player.y, player.w, player.h, 8); ctx.fill();

      // bullets
      ctx.fillStyle='#9ff'; bullets.forEach(b=>{ ctx.fillRect(b.x-2,b.y-8,4,8); });

      // bacteria
      bacteria.forEach(b=>{
        ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle='#7fce3a'; ctx.fill();
        // little flagella
        ctx.strokeStyle='rgba(0,0,0,0.15)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(b.x+b.r*.7,b.y); ctx.lineTo(b.x+b.r*1.5,b.y-6); ctx.stroke();
      });

      // hud
      document.getElementById('score').innerText = 'Score: '+score;
      document.getElementById('lives').innerText = 'Lives: '+lives;

      if(!running) drawPause();
    }

    function drawPause(){
      ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#fff'; ctx.font='24px Arial'; ctx.textAlign='center';
      ctx.fillText(lives>0? 'Game Over' : 'Game Over', W/2, H/2 - 10);
      ctx.font='14px Arial'; ctx.fillText('Press Restart to play again', W/2, H/2+18);
    }

    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); }

    // input
    window.addEventListener('keydown',e=>{ keys[e.key]=true; if(e.key===' '){ bullets.push({x:player.x+player.w/2,y:player.y-6}); e.preventDefault(); } });
    window.addEventListener('keyup',e=>{ keys[e.key]=false; });

    document.getElementById('restart').addEventListener('click',()=>{ reset(); loop(); });

    // start
    reset(); loop();
  </script>
</body>
</html>
